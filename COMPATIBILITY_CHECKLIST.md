# 이메일 인증 마이그레이션 호환성 체크리스트

## 🎯 개요
이 체크리스트는 사번 기반 인증에서 이메일 기반 인증으로 마이그레이션한 후 모든 기능이 정상적으로 작동하는지 확인하기 위한 것입니다.

## ✅ 자동 테스트 결과
```bash
node scripts/test-auth-compatibility.js
```
- [x] 데이터베이스 스키마 정상
- [x] get_public_reservations 함수 작동
- [x] create_user_profile 함수 작동
- [x] 사용자 프로필 조회 정상
- [x] 예약-사용자 관계 정상
- [x] RLS 정책 정상

## 🧪 수동 테스트 체크리스트

### 1. 인증 시스템 테스트

#### 회원가입 플로우
- [ ] 이메일 + 비밀번호로 회원가입 가능
- [ ] 강력한 비밀번호 검증 작동 (대소문자 + 숫자)
- [ ] 회원가입 후 이메일 인증 메일 발송
- [ ] 이메일 인증 링크 클릭 시 `/auth/callback` 페이지 정상 작동
- [ ] 이메일 인증 완료 후 데이터베이스에 사용자 프로필 자동 생성
- [ ] 이메일 재발송 기능 정상 작동

#### 로그인 플로우
- [ ] 이메일 + 비밀번호로 로그인 가능
- [ ] 미인증 사용자 로그인 차단 (명확한 에러 메시지)
- [ ] 로그인 성공 시 메인 페이지로 리디렉션
- [ ] 로그아웃 기능 정상 작동

### 2. 사용자 프로필 표시 테스트

#### 메인 페이지 (`/`)
- [ ] 로그인된 사용자 이름 표시: "안녕하세요, {name}님!"
- [ ] 사용자 부서 및 역할 표시: "{department} · {role}"
- [ ] 관리자 사용자에게 관리자 메뉴 표시
- [ ] 비로그인 사용자에게 로그인/회원가입 버튼 표시

#### 대시보드 페이지 (`/dashboard`)
- [ ] 로그인된 사용자만 접근 가능
- [ ] 사용자 정보 정상 표시
- [ ] 예약 현황 정상 조회

### 3. 예약 시스템 테스트

#### 예약 생성 (`/reservations/new`)
- [ ] 로그인된 사용자만 접근 가능
- [ ] 예약 생성 시 현재 사용자 정보로 예약자 설정
- [ ] 예약 생성 후 데이터베이스에 정상 저장
- [ ] 예약 생성 후 목록에서 확인 가능

#### 내 예약 조회 (`/reservations/my`)
- [ ] 로그인된 사용자의 예약만 표시
- [ ] 예약 정보 정상 표시 (제목, 시간, 회의실 등)
- [ ] 예약 수정/취소 기능 정상 작동

#### 예약 현황 (`/reservations/status`)
- [ ] 전체 예약 현황 정상 표시
- [ ] 내 예약은 상세 정보 표시, 타인 예약은 "Booked"로 마스킹
- [ ] 실시간 업데이트 정상 작동

### 4. 관리자 기능 테스트

#### 관리자 대시보드 (`/admin`)
- [ ] 관리자 권한 사용자만 접근 가능
- [ ] 전체 사용자 목록 조회 가능
- [ ] 전체 예약 목록 조회 가능
- [ ] 회의실 관리 기능 정상 작동

### 5. 권한 및 보안 테스트

#### 접근 제어
- [ ] 비로그인 사용자는 보호된 페이지 접근 시 로그인 페이지로 리디렉션
- [ ] 일반 사용자는 관리자 페이지 접근 시 권한 오류
- [ ] RLS 정책으로 데이터 접근 제어 정상 작동

#### 데이터 보안
- [ ] 사용자는 자신의 예약만 수정/삭제 가능
- [ ] 타인의 예약 상세 정보는 마스킹되어 표시
- [ ] SQL 인젝션 등 보안 취약점 없음

### 6. 기존 호환성 테스트

#### 기존 데이터 호환성
- [ ] 기존 예약 데이터 정상 표시
- [ ] 기존 회의실 데이터 정상 표시
- [ ] 기존 사용자 데이터 정상 마이그레이션

#### API 호환성
- [ ] `get_public_reservations` 함수 정상 작동
- [ ] 예약 CRUD 작업 정상 작동
- [ ] 실시간 구독 기능 정상 작동

## 🐛 알려진 이슈 및 해결 방법

### 1. 이메일 인증 관련
**문제**: 이메일이 스팸 폴더로 이동
**해결**: 사용자에게 스팸 폴더 확인 안내

**문제**: 이메일 인증 링크 만료
**해결**: 이메일 재발송 기능 사용

### 2. 사용자 프로필 관련
**문제**: 기존 사용자의 `employee_id`가 NULL
**해결**: 정상적인 동작 (이메일 기반 인증으로 변경됨)

**문제**: 사용자 프로필이 데이터베이스에 생성되지 않음
**해결**: 이메일 인증 완료 후 자동 생성됨

## 📊 성능 테스트

### 응답 시간 확인
- [ ] 로그인: < 2초
- [ ] 예약 목록 조회: < 3초
- [ ] 예약 생성: < 2초
- [ ] 대시보드 로딩: < 3초

### 동시 사용자 테스트
- [ ] 10명 동시 로그인 테스트
- [ ] 동시 예약 생성 테스트
- [ ] 실시간 업데이트 테스트

## 🚀 배포 전 최종 체크

### 환경 설정
- [ ] 프로덕션 환경변수 설정 완료
- [ ] Supabase 프로젝트 설정 완료
- [ ] 이메일 발송 설정 완료

### 데이터베이스
- [ ] 프로덕션 데이터베이스 마이그레이션 완료
- [ ] 백업 생성 완료
- [ ] RLS 정책 적용 완료

### 모니터링
- [ ] 에러 로깅 설정 완료
- [ ] 성능 모니터링 설정 완료
- [ ] 알림 설정 완료

## ✅ 테스트 완료 확인

**테스트 수행자**: ________________  
**테스트 일시**: ________________  
**테스트 환경**: ________________  

**전체 테스트 결과**: 
- [ ] 모든 테스트 통과
- [ ] 일부 이슈 있음 (아래 기록)

**발견된 이슈**:
```
이슈 1: 
해결 방법: 

이슈 2:
해결 방법:
```

**최종 승인**: ________________  
**배포 승인**: ________________